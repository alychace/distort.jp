<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    

    
        <title>
             Fixing AMD &amp; Intel Power Management under Linux
            
        </title>

        
            <meta property="og:title" content="Fixing AMD &amp; Intel Power Management under Linux" />
        
    

    <meta property="og:image" content="&#x2F;imgs&#x2F;pp-to-epp.jpg"/>

    
        
            <meta property="og:description" content="Saving battery life &amp; unlocking greater performance by syncing Intel &amp; AMD CPU Energy Performance Preferences with system power profiles." />
        
    

    
        
            <meta name="description" content="Saving battery life &amp; unlocking greater performance by syncing Intel &amp; AMD CPU Energy Performance Preferences with system power profiles." />
        
    

    
         <link rel="icon" type="image/png" href=&#x2F;icon&#x2F;favicon.png />
    

    

    
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-040DR443G9"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-040DR443G9');
        </script>
    

    
    
        <script src=https://distort.jp/js/feather.min.js></script>
    


    
        <link href=https://distort.jp/css/fonts.css rel="stylesheet" />
    

    <link rel="stylesheet" type="text/css" media="screen" href=https://distort.jp/css/main.css />

    
        <link
            rel="stylesheet"
            id="darkModeStyle"
            type="text/css"
            href=https://distort.jp/css/dark.css
            
                media="(prefers-color-scheme: dark)"
            
            
        />
    


    
    
        <link rel="alternate" type="application/rss+xml" title="RSS" href="https://distort.jp/rss.xml">
    



</head>


<body>
    <div class="content">
        <header>
    <div class="main" id="main_title">
        <a href=https:&#x2F;&#x2F;distort.jp>Specular Anomalies</a>
    </div>

    <nav>
        
            <a href=&#x2F;>Home</a>
        
            <a href=&#x2F;posts>Archive</a>
        

        

        
    </nav>
</header>


        
    
<main>
    <article>
        <div class="title">
            <h1 class="title">Fixing AMD &amp; Intel Power Management under Linux</h1>
            <div class="meta">
                
                on  2024-01-30

                
            </div>
        </div>

        

        <section class="body">
            <p><img src="/imgs/pp-to-epp.jpg" alt="pp_to_epp.jpg" /></p>
<p>I was recently in the market for a laptop, and got a great deal on an Asus ROG Zephyrus G14 from Best Buy. It's a powerful machine, with an AMD Ryzen 7840HS processor, 16GB RAM, and an Nvidia RTX 4060, and, at first, seemed to work well enough under Linux, my preferred operating system. In the month-ish that I owned it, I discovered a wonderful community of folks actively working on developing and supporting <a href="https://asus-linux.org/">Linux on Asus laptops</a>, filling in the userspace gaps and patching the kernel as needed to deliver a somewhat workable experience. </p>
<p>After weeks of diving through forums, the asus-linux discord, and random bug trackers, I found one of the biggest issues on modern AMD laptops involves the <code>amd-pstate</code> driver's exposure of the processor's energy performance preference. EPP works like a far more intelligent and impactful version of old school CPU governors. The <code>amd-pstate</code> kernel driver <a href="https://docs.kernel.org/admin-guide/pm/amd-pstate.html">docs</a> explain this further, but the gist is EPP is the key to getting the most performance <em>and</em> the best battery life out of your laptop CPU.</p>
<p>The problem is that the version of <code>power-profiles-daemon</code> currently being shipped by most distros doesn't automatically adjust the EPP based on the user's stated performance profile, leading to increased battery usage, particularly at idle or when doing simple tasks. Power-profiles-daemon is unable to use the <code>amd-pstate</code> driver, so the setting never gets adjusted, leading to mismatched performance and cooling choices between <code>platform_profile</code> and <code>amd-pstate</code> on modern AMD laptops. Luckily, the community—particularly Marcin <a href="https://github.com/marcinx64">@marcinx64</a>—have developed a simple Python <a href="https://github.com/marcinx64">daemon</a> to automatically adjust the EPP based on the chosen power profile.</p>
<p>Unfortunately, after a series of hardware problems (severe IPS backlight bleed), an exchange, and standard Nvidia buggyness (at least on Linux) later, I ended up returning the Asus for a Lenovo Yoga 9i with an Intel Core i7 1360P, 16GB RAM, and integrated graphics. I know, totally different product category. Oh well. But as it turns out, the <code>intel-pstate</code> driver is also affected by the same issue in <code>power-profiles-daemon</code>, but no utility exists for Intel users. Luckily, the interfaces exposed by the kernel for controlling EPP are basically the same, so I've forked Marcin's utility to provide a <a href="https://github.com/alychace/pp-to-epp">temporary solution</a> for Intel and AMD users alike.</p>
<p>There's an open <a href="https://gitlab.freedesktop.org/upower/power-profiles-daemon/-/issues/107">issue</a> in <code>power-profiles-daemon</code> to allow it to leverage both <code>platform_profile</code> and <code>amd-pstate</code>/<code>intel-pstate</code> simultaneously to deliver the best performance or power savings possible. Until then, this daemon provides a solid workaround for pstate power control for GNU/Linux users. For my G14, and now my Yoga 9i, this means getting battery life in Fedora 39 that meets or exceeds Windows 11. It should also work under other distros that use systemd (sorry protest distros!) and power-profiles-daemon.</p>
<p>PS: I know this is a big departure from this blog's previous content. A lot has happened since then: a phd program left behind, a worldwide pandemic, a total career change, and several years of wandering. This blog has always been about technology in some form or fashion, so why the hell not? Beats making a new one.</p>

        </section>

        
            <div class="post-tags">
                <nav class="nav tags">
                    <ul class="tags">
                        
                            <li><a href=https://distort.jp/tags/linux/>Linux</a></li>
                        
                            <li><a href=https://distort.jp/tags/power-profiles-daemon/>power-profiles-daemon</a></li>
                        
                            <li><a href=https://distort.jp/tags/amd/>AMD</a></li>
                        
                            <li><a href=https://distort.jp/tags/intel/>Intel</a></li>
                        
                            <li><a href=https://distort.jp/tags/fedora/>Fedora</a></li>
                        
                            <li><a href=https://distort.jp/tags/python/>Python</a></li>
                        
                    </ul>
                </nav>
            </div>
        

    </article>
</main>



        <footer>
  <div style="display:flex">
    
        <a class="soc" href=https:&#x2F;&#x2F;mastodon.social&#x2F;@alyc title=Mastodon>
            <i data-feather=at-sign></i>
        </a>
    
        <a class="soc" href=https:&#x2F;&#x2F;github.com&#x2F;alychace title=GitHub>
            <i data-feather=github></i>
        </a>
    
  </div>
  <div class="footer-info">
    2024 © aly | Based on the <a
      href="https://github.com/XXXMrG/archie-zola">Archie-Zola Theme</a>.
  </div>
</footer>


<script>
    feather.replace();
</script>


    </div>
</body>

</html>
